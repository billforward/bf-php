#Running legacy tests (for devs)
We prefer from now on to work with the new style of test in the `new/` folder.

But here are instructions for the brave who wish to run the legacy style of test.

##Setup
Tests connect to the user defined in `TestConfig.php`.

Most tests require data to exist on the account you log into.

###Step 1. Register on Sandbox
Register a user on Sandbox, that you are happy with using for tests.

Get an access token for this user.

###Step 2. Point TestConfig at this user
Provide an access token and API URL for connecting.

```
$this->access_token = '';
// example urlRoot (version number subject to change):
// https://api-sandbox.billforward.net/2014.223.0/
$this->urlRoot = '';
```

You will notice also many blank `usual` variables (for example `$this->usualLoginUserID = '';`). They are IDs for real entities. Tests are invited to play with these entities.

This way we avoid hardcoding 'magic numbers' into tests; instead they get() an entity advertised in the config.


You will need to populate these variables with IDs from real data. We will generate that dataset now.

###Step 3. Run the one-off `BuildSampleDataTest`
This test — `BuildSampleDataTest_OneOff.php` — creates many entities on the BillForward system, and prints out their IDs in a format that can be copy-pasted into your TestConfig.

Running this test is the standard way of preparing a new user account to have tests run against it.


We use phpunit as our testrunner. If you have run `./gradlew setup`, you will find already a phpunit binary in `vendor/bin/phpunit`.

(Requires phpunit on PATH).

You can run this particular test by invoking:

```
phpunit BuildSampleDataTest_OneOff.php
```

Provided this test succeeds, you will see it print a copy-pasteable set of IDs you can use in your `TestConfig.php`.

##Invocation
Setup data on your test user (see previous section), and copy-paste it into your `TestConfig.php`, otherwise tests will receive no data and fail.


(Requires phpunit on PATH).

To run all tests, cd to the repository root and invoke:
```
phpunit
```

phpunit will read `phpunit.xml` to find tests.

The tests themselves rely on `vendor/bin/autoload.php` (generated by Composer) to find their dependencies.

###Run individual file
A custom Sublime script can be used, for example (requires `phpunit` on PATH):

```
{
	"cmd": ["phpunit", "$file"],
	"selector": "source.php"
}
```